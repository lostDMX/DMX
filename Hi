--// Ø§Ù„Ø®Ø¯Ù…Ø§Øª
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")

--// Ø§Ù„Ù„Ø§Ø¹Ø¨
local Player = Players.LocalPlayer
local Character = Player.Character or Player.CharacterAdded:Wait()
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")

--// Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
local Farming = false
local MoveTween
local MOVE_SPEED = 1.5
local VISIT_DELAY = 1.5
local VisitedCoins = {}

--// Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
local ScreenGui = Instance.new("ScreenGui", Player.PlayerGui)
ScreenGui.Name = "CoinFarmSimple"
ScreenGui.ResetOnSpawn = false

-- Ø²Ø± Ø§Ù„ØªØ¨Ø¯ÙŠÙ„
local ToggleButton = Instance.new("TextButton", ScreenGui)
ToggleButton.Size = UDim2.fromOffset(50, 50)
ToggleButton.Position = UDim2.fromScale(0.05, 0.4)
ToggleButton.Text = "ğŸ’°"
ToggleButton.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
ToggleButton.TextColor3 = Color3.new(1, 1, 1)
ToggleButton.Font = Enum.Font.GothamBold
ToggleButton.TextSize = 24
ToggleButton.Active = true
ToggleButton.Draggable = true
Instance.new("UICorner", ToggleButton).CornerRadius = UDim.new(1, 0)

-- Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
local Frame = Instance.new("Frame", ScreenGui)
Frame.Size = UDim2.fromOffset(400, 300)
Frame.Position = UDim2.fromScale(0.3, 0.3)
Frame.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
Frame.Visible = false
Frame.Active = true
Frame.Draggable = true
Instance.new("UICorner", Frame).CornerRadius = UDim.new(0, 12)

-- Ø¥Ø·Ø§Ø± Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
local Header = Instance.new("Frame", Frame)
Header.Size = UDim2.new(1, 0, 0, 50)
Header.Position = UDim2.fromOffset(0, 0)
Header.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
Header.BorderSizePixel = 0
Instance.new("UICorner", Header).CornerRadius = UDim.new(0, 12)

-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
local Title = Instance.new("TextLabel", Header)
Title.Size = UDim2.new(1, -60, 1, 0)
Title.Position = UDim2.fromOffset(15, 0)
Title.BackgroundTransparency = 1
Title.Text = "ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„Ø§Øª"
Title.TextColor3 = Color3.fromRGB(255, 215, 0)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 20
Title.TextXAlignment = Enum.TextXAlignment.Left

-- Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
local CloseBtn = Instance.new("TextButton", Header)
CloseBtn.Size = UDim2.fromOffset(30, 30)
CloseBtn.Position = UDim2.new(1, -40, 0.5, -15)
CloseBtn.Text = "âœ•"
CloseBtn.Font = Enum.Font.GothamBold
CloseBtn.TextSize = 18
CloseBtn.TextColor3 = Color3.new(1, 0.3, 0.3)
CloseBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
Instance.new("UICorner", CloseBtn).CornerRadius = UDim.new(1, 0)

-- Ø§Ù„Ø­Ø§Ù„Ø©
local StatusLabel = Instance.new("TextLabel", Frame)
StatusLabel.Size = UDim2.new(1, -30, 0, 25)
StatusLabel.Position = UDim2.fromOffset(15, 65)
StatusLabel.BackgroundTransparency = 1
StatusLabel.Text = "Ø§Ù„Ø­Ø§Ù„Ø©: Ù…ØªÙˆÙ‚Ù"
StatusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
StatusLabel.Font = Enum.Font.GothamSemibold
StatusLabel.TextSize = 16
StatusLabel.TextXAlignment = Enum.TextXAlignment.Left

-- Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Øª
local CoinsLabel = Instance.new("TextLabel", Frame)
CoinsLabel.Size = UDim2.new(1, -30, 0, 25)
CoinsLabel.Position = UDim2.fromOffset(15, 95)
CoinsLabel.BackgroundTransparency = 1
CoinsLabel.Text = "Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø¬Ù…Ø¹Ø©: 0"
CoinsLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
CoinsLabel.Font = Enum.Font.GothamSemibold
CoinsLabel.TextSize = 16
CoinsLabel.TextXAlignment = Enum.TextXAlignment.Left

-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ…
local ControlsFrame = Instance.new("Frame", Frame)
ControlsFrame.Size = UDim2.new(1, -30, 0, 50)
ControlsFrame.Position = UDim2.fromOffset(15, 130)
ControlsFrame.BackgroundTransparency = 1

-- Ø²Ø± Ø§Ù„ØªØ´ØºÙŠÙ„
local StartBtn = Instance.new("TextButton", ControlsFrame)
StartBtn.Size = UDim2.new(0.48, 0, 1, 0)
StartBtn.Position = UDim2.fromOffset(0, 0)
StartBtn.Text = "â–¶ ØªØ´ØºÙŠÙ„"
StartBtn.Font = Enum.Font.GothamBold
StartBtn.TextSize = 18
StartBtn.TextColor3 = Color3.new(1, 1, 1)
StartBtn.BackgroundColor3 = Color3.fromRGB(50, 180, 80)
Instance.new("UICorner", StartBtn).CornerRadius = UDim.new(0, 8)

-- Ø²Ø± Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù
local StopBtn = Instance.new("TextButton", ControlsFrame)
StopBtn.Size = UDim2.new(0.48, 0, 1, 0)
StopBtn.Position = UDim2.new(0.52, 0, 0, 0)
StopBtn.Text = "â¹ Ø¥ÙŠÙ‚Ø§Ù"
StopBtn.Font = Enum.Font.GothamBold
StopBtn.TextSize = 18
StopBtn.TextColor3 = Color3.new(1, 1, 1)
StopBtn.BackgroundColor3 = Color3.fromRGB(220, 80, 80)
Instance.new("UICorner", StopBtn).CornerRadius = UDim.new(0, 8)

-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙˆÙ‚ÙŠØª
local SettingsFrame = Instance.new("Frame", Frame)
SettingsFrame.Size = UDim2.new(1, -30, 0, 90)
SettingsFrame.Position = UDim2.fromOffset(15, 190)
SettingsFrame.BackgroundTransparency = 1

-- ØªØ£Ø®ÙŠØ± Ø§Ù„Ø²ÙŠØ§Ø±Ø©
local DelayContainer = Instance.new("Frame", SettingsFrame)
DelayContainer.Size = UDim2.new(1, 0, 0, 40)
DelayContainer.Position = UDim2.fromOffset(0, 0)
DelayContainer.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
Instance.new("UICorner", DelayContainer).CornerRadius = UDim.new(0, 8)

local DelayLabel = Instance.new("TextLabel", DelayContainer)
DelayLabel.Size = UDim2.new(0.5, 0, 1, 0)
DelayLabel.Position = UDim2.fromOffset(10, 0)
DelayLabel.BackgroundTransparency = 1
DelayLabel.Text = "ØªØ£Ø®ÙŠØ±: "..VISIT_DELAY.."s"
DelayLabel.TextColor3 = Color3.fromRGB(200, 200, 220)
DelayLabel.Font = Enum.Font.Gotham
DelayLabel.TextSize = 14
DelayLabel.TextXAlignment = Enum.TextXAlignment.Left

local DelayMinus = Instance.new("TextButton", DelayContainer)
DelayMinus.Size = UDim2.fromOffset(30, 30)
DelayMinus.Position = UDim2.new(0.5, 10, 0.5, -15)
DelayMinus.Text = "-"
DelayMinus.Font = Enum.Font.GothamBold
DelayMinus.TextSize = 18
DelayMinus.TextColor3 = Color3.new(1, 0.3, 0.3)
DelayMinus.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
Instance.new("UICorner", DelayMinus).CornerRadius = UDim.new(0, 6)

local DelayPlus = Instance.new("TextButton", DelayContainer)
DelayPlus.Size = UDim2.fromOffset(30, 30)
DelayPlus.Position = UDim2.new(0.7, 10, 0.5, -15)
DelayPlus.Text = "+"
DelayPlus.Font = Enum.Font.GothamBold
DelayPlus.TextSize = 18
DelayPlus.TextColor3 = Color3.new(0.3, 1, 0.3)
DelayPlus.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
Instance.new("UICorner", DelayPlus).CornerRadius = UDim.new(0, 6)

-- Ø³Ø±Ø¹Ø© Ø§Ù„Ø­Ø±ÙƒØ©
local SpeedContainer = Instance.new("Frame", SettingsFrame)
SpeedContainer.Size = UDim2.new(1, 0, 0, 40)
SpeedContainer.Position = UDim2.fromOffset(0, 50)
SpeedContainer.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
Instance.new("UICorner", SpeedContainer).CornerRadius = UDim.new(0, 8)

local SpeedLabel = Instance.new("TextLabel", SpeedContainer)
SpeedLabel.Size = UDim2.new(0.5, 0, 1, 0)
SpeedLabel.Position = UDim2.fromOffset(10, 0)
SpeedLabel.BackgroundTransparency = 1
SpeedLabel.Text = "Ø§Ù„Ø³Ø±Ø¹Ø©: "..MOVE_SPEED
SpeedLabel.TextColor3 = Color3.fromRGB(200, 200, 220)
SpeedLabel.Font = Enum.Font.Gotham
SpeedLabel.TextSize = 14
SpeedLabel.TextXAlignment = Enum.TextXAlignment.Left

local SpeedMinus = Instance.new("TextButton", SpeedContainer)
SpeedMinus.Size = UDim2.fromOffset(30, 30)
SpeedMinus.Position = UDim2.new(0.5, 10, 0.5, -15)
SpeedMinus.Text = "-"
SpeedMinus.Font = Enum.Font.GothamBold
SpeedMinus.TextSize = 18
SpeedMinus.TextColor3 = Color3.new(1, 0.3, 0.3)
SpeedMinus.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
Instance.new("UICorner", SpeedMinus).CornerRadius = UDim.new(0, 6)

local SpeedPlus = Instance.new("TextButton", SpeedContainer)
SpeedPlus.Size = UDim2.fromOffset(30, 30)
SpeedPlus.Position = UDim2.new(0.7, 10, 0.5, -15)
SpeedPlus.Text = "+"
SpeedPlus.Font = Enum.Font.GothamBold
SpeedPlus.TextSize = 18
SpeedPlus.TextColor3 = Color3.new(0.3, 1, 0.3)
SpeedPlus.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
Instance.new("UICorner", SpeedPlus).CornerRadius = UDim.new(0, 6)

--// Ù…Ù†Ø·Ù‚ Ø§Ù„Ø³ÙƒØ±Ø¨Øª (Ù†ÙØ³ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø¨Ø§Ù„Ø¶Ø¨Ø·)
local TotalCoins = 0

local function GetNextClosestCoin()
    local closestCoin
    local shortest = math.huge

    for _,v in ipairs(workspace:GetDescendants()) do
        if v:IsA("BasePart")
            and v.Name == "Coin_Server"
            and v.Parent
            and not VisitedCoins[v] then

            local dist = (HumanoidRootPart.Position - v.Position).Magnitude
            if dist < shortest then
                shortest = dist
                closestCoin = v
            end
        end
    end

    return closestCoin
end

local function MoveToCoin(part)
    if not part or not part.Parent then return end
    if MoveTween then
        MoveTween:Cancel()
    end

    local distance = (HumanoidRootPart.Position - part.Position).Magnitude

    if distance < 3 then
        HumanoidRootPart.CFrame = CFrame.new(part.Position + Vector3.new(0, 2, 0))
    else
        local target = CFrame.new(part.Position + Vector3.new(0, 2, 0))
        local info = TweenInfo.new(MOVE_SPEED, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
        MoveTween = TweenService:Create(HumanoidRootPart, info, {CFrame = target})
        MoveTween:Play()
        MoveTween.Completed:Wait()
    end
    
    TotalCoins = TotalCoins + 1
    CoinsLabel.Text = "Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø¬Ù…Ø¹Ø©: "..TotalCoins
end

local function StartFarm()
    if Farming then return end
    Farming = true
    StatusLabel.Text = "Ø§Ù„Ø­Ø§Ù„Ø©: ÙŠØ¹Ù…Ù„"
    StatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
    table.clear(VisitedCoins)
    
    task.spawn(function()
        while Farming do
            local coin = GetNextClosestCoin()
            if not coin then
                table.clear(VisitedCoins)
                task.wait(0.3)
                continue
            end
            MoveToCoin(coin)
            VisitedCoins[coin] = true
            task.wait(VISIT_DELAY)
        end
    end)
end

local function StopFarm()
    Farming = false
    StatusLabel.Text = "Ø§Ù„Ø­Ø§Ù„Ø©: Ù…ØªÙˆÙ‚Ù"
    StatusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
    if MoveTween then
        MoveTween:Cancel()
    end
end

--// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙŠÙ…
DelayPlus.MouseButton1Click:Connect(function()
    VISIT_DELAY = VISIT_DELAY + 0.1
    DelayLabel.Text = "ØªØ£Ø®ÙŠØ±: "..string.format("%.1f", VISIT_DELAY).."s"
end)

DelayMinus.MouseButton1Click:Connect(function()
    VISIT_DELAY = math.max(0.1, VISIT_DELAY - 0.1)
    DelayLabel.Text = "ØªØ£Ø®ÙŠØ±: "..string.format("%.1f", VISIT_DELAY).."s"
end)

SpeedPlus.MouseButton1Click:Connect(function()
    MOVE_SPEED = MOVE_SPEED + 0.1
    SpeedLabel.Text = "Ø§Ù„Ø³Ø±Ø¹Ø©: "..string.format("%.1f", MOVE_SPEED)
end)

SpeedMinus.MouseButton1Click:Connect(function()
    MOVE_SPEED = math.max(0.1, MOVE_SPEED - 0.1)
    SpeedLabel.Text = "Ø§Ù„Ø³Ø±Ø¹Ø©: "..string.format("%.1f", MOVE_SPEED)
end)

--// Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
ToggleButton.MouseButton1Click:Connect(function()
    Frame.Visible = not Frame.Visible
end)

StartBtn.MouseButton1Click:Connect(StartFarm)
StopBtn.MouseButton1Click:Connect(StopFarm)

CloseBtn.MouseButton1Click:Connect(function()
    Frame.Visible = false
end)

Player.CharacterAdded:Connect(function(char)
    Character = char
    HumanoidRootPart = char:WaitForChild("HumanoidRootPart")
end)
